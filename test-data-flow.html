<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ•°æ®æµæµ‹è¯•å·¥å…·</title>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #0a0d18;
      color: #e0e4f0;
    }
    h1 { color: #4facfe; }
    .section {
      background: #1a1f2e;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #2a3142;
    }
    button {
      background: #4facfe;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #3d8dd6; }
    pre {
      background: #0f121a;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
    }
    .status { 
      padding: 10px; 
      margin: 10px 0; 
      border-radius: 5px; 
    }
    .success { background: #2d5f2d; }
    .error { background: #5f2d2d; }
    .warning { background: #5f4d2d; }
  </style>
</head>
<body>
  <h1>ğŸ” æ•°æ®æµè¯Šæ–­å·¥å…·</h1>
  
  <div class="section">
    <h2>1. æ£€æŸ¥ localStorage æ•°æ®</h2>
    <button onclick="checkLocalStorage()">æ£€æŸ¥å½“å‰æ•°æ®</button>
    <button onclick="clearLocalStorage()">æ¸…ç©º localStorage</button>
    <div id="localStorage-result"></div>
  </div>

  <div class="section">
    <h2>2. æ·»åŠ æµ‹è¯•å·¥ä½œç»éªŒ</h2>
    <button onclick="addTestWork()">æ·»åŠ æµ‹è¯•å·¥ä½œ</button>
    <button onclick="addTestEducation()">æ·»åŠ æµ‹è¯•å­¦å†</button>
    <div id="add-result"></div>
  </div>

  <div class="section">
    <h2>3. æ£€æŸ¥å‰å°æ˜¾ç¤º</h2>
    <button onclick="window.open('index.html', '_blank')">æ‰“å¼€å‰å°é¡µé¢</button>
    <p>æŸ¥çœ‹å‰å°æ˜¯å¦æ˜¾ç¤ºæ–°æ·»åŠ çš„æ•°æ®</p>
  </div>

  <div class="section">
    <h2>4. è¯Šæ–­ç»“æœ</h2>
    <div id="diagnosis"></div>
  </div>

  <script>
    const STORAGE_KEY = 'cvData';

    function checkLocalStorage() {
      const result = document.getElementById('localStorage-result');
      const raw = localStorage.getItem(STORAGE_KEY);
      
      if (!raw) {
        result.innerHTML = '<div class="status error">âŒ localStorage ä¸­æ²¡æœ‰ cvData</div>';
        return;
      }

      try {
        const data = JSON.parse(raw);
        const workCount = data.experience?.filter(e => e.type === 'Work').length || 0;
        const eduCount = data.experience?.filter(e => e.type === 'Education').length || 0;
        
        result.innerHTML = `
          <div class="status success">âœ… æ‰¾åˆ°æ•°æ®ï¼</div>
          <p>å·¥ä½œç»éªŒæ•°é‡: ${workCount}</p>
          <p>å­¦å†æ•°é‡: ${eduCount}</p>
          <p>æŠ€èƒ½æ•°é‡: ${data.skills?.length || 0}</p>
          <p>é¡¹ç›®æ•°é‡: ${data.projects?.length || 0}</p>
          <details>
            <summary>æŸ¥çœ‹å®Œæ•´æ•°æ®ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </details>
        `;
      } catch (err) {
        result.innerHTML = `<div class="status error">âŒ æ•°æ®è§£æé”™è¯¯: ${err.message}</div>`;
      }
    }

    function clearLocalStorage() {
      if (confirm('ç¡®å®šè¦æ¸…ç©º localStorageï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼')) {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem('cvTheme');
        localStorage.removeItem('cvAdminSession');
        document.getElementById('localStorage-result').innerHTML = 
          '<div class="status warning">âš ï¸ localStorage å·²æ¸…ç©º</div>';
      }
    }

    function addTestWork() {
      const result = document.getElementById('add-result');
      const raw = localStorage.getItem(STORAGE_KEY);
      let data;

      try {
        if (!raw) {
          result.innerHTML = '<div class="status error">âŒ è¯·å…ˆåˆå§‹åŒ–æ•°æ®ï¼ˆè®¿é—®å‰å°æˆ–åå°é¡µé¢ï¼‰</div>';
          return;
        }

        data = JSON.parse(raw);
        
        const testWork = {
          id: crypto.randomUUID(),
          type: 'Work',
          company: 'æµ‹è¯•å…¬å¸ Test Corp',
          role: 'æµ‹è¯•èŒä½ Test Role',
          period: '2024-2026',
          summary: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å·¥ä½œç»éªŒï¼Œç”¨äºè¯Šæ–­æ•°æ®æµé—®é¢˜ã€‚å¦‚æœå‰å°èƒ½çœ‹åˆ°è¿™æ¡ï¼Œè¯´æ˜æ•°æ®æµæ­£å¸¸ã€‚'
        };

        if (!Array.isArray(data.experience)) {
          data.experience = [];
        }

        data.experience.unshift(testWork);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

        result.innerHTML = `
          <div class="status success">âœ… æµ‹è¯•å·¥ä½œå·²æ·»åŠ ï¼</div>
          <p>ID: ${testWork.id}</p>
          <p>ç°åœ¨è¯·åˆ·æ–°å‰å°é¡µé¢æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º</p>
        `;
      } catch (err) {
        result.innerHTML = `<div class="status error">âŒ æ·»åŠ å¤±è´¥: ${err.message}</div>`;
      }
    }

    function addTestEducation() {
      const result = document.getElementById('add-result');
      const raw = localStorage.getItem(STORAGE_KEY);
      let data;

      try {
        if (!raw) {
          result.innerHTML = '<div class="status error">âŒ è¯·å…ˆåˆå§‹åŒ–æ•°æ®ï¼ˆè®¿é—®å‰å°æˆ–åå°é¡µé¢ï¼‰</div>';
          return;
        }

        data = JSON.parse(raw);
        
        const testEdu = {
          id: crypto.randomUUID(),
          type: 'Education',
          company: 'æµ‹è¯•å¤§å­¦ Test University',
          role: 'æµ‹è¯•å­¦ä½ Test Degree',
          period: '2020-2024',
          summary: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å­¦å†ï¼Œç”¨äºè¯Šæ–­æ•°æ®æµé—®é¢˜ã€‚'
        };

        if (!Array.isArray(data.experience)) {
          data.experience = [];
        }

        data.experience.unshift(testEdu);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

        result.innerHTML = `
          <div class="status success">âœ… æµ‹è¯•å­¦å†å·²æ·»åŠ ï¼</div>
          <p>ID: ${testEdu.id}</p>
          <p>ç°åœ¨è¯·åˆ·æ–°å‰å°é¡µé¢æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º</p>
        `;
      } catch (err) {
        result.innerHTML = `<div class="status error">âŒ æ·»åŠ å¤±è´¥: ${err.message}</div>`;
      }
    }

    // è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥
    window.addEventListener('load', () => {
      checkLocalStorage();
    });
  </script>
</body>
</html>
